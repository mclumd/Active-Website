<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 99.1 release (March 30, 1999)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The Input Editing Stream Protocol</TITLE>
<META NAME="description" CONTENT="The Input Editing Stream Protocol">
<META NAME="keywords" CONTENT="clim">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v99.1 release">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="clim.css">

<LINK REL="next" HREF="node234.html">
<LINK REL="previous" HREF="node232.html">
<LINK REL="up" HREF="node232.html">
<LINK REL="next" HREF="node234.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3932"
 HREF="node234.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3928"
 HREF="node232.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3922"
 HREF="node232.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3930"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3933"
 HREF="node234.html">Suggestions for Input Editing</A>
<B> Up:</B> <A NAME="tex2html3929"
 HREF="node232.html">The Input Editor</A>
<B> Previous:</B> <A NAME="tex2html3923"
 HREF="node232.html">The Input Editor</A>
 &nbsp <B>  <A NAME="tex2html3931"
 HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION07311000000000000000">
The Input Editing Stream Protocol</A>
</H2>

<P>
Input editing streams obey both the extended input and extended output stream
protocols, and must support the generic functions that comprise those protocols.
For the most part, this will simply entail ``trampolining'' those operations to
the encapsulated interactive stream.  However, some generic functions as
stream-read-gesture and stream-unread-gesture will need methods that
observe the use of the input editor's scan pointer.

<P>
Input editing streams will typically also implement methods for
prompt-for-accept (in order to provide in-line prompting that interacts
correctly with input editing) and stream-accept (in order to cause
accept to obey the scan pointer).

<P>
The following generic functions comprise the remainder of the input editing
protocol, and must be implemented for all classes that inherit from
input-editing-stream.

<P>
stream-input-buffer (stream input-editing-stream)

<P>
Returns the input buffer (that is, the string being edited) associated with the
<I> input editing stream</I> <I> stream</I>.  This must be an unspecialized array
with a fill pointer.  The fill pointer of the array points past the last gesture
object in the buffer.  During input editing, this buffer is side-effected.  The
consequences of modifying the input buffer by means other than the specified API
(such as replace-input) are unspecified.

<P>
stream-insertion-pointer stream

<P>
Returns an integer corresponding to the current input position in the
<I> input editing stream</I> <I> stream</I>'s buffer, that is, the point in the
buffer at which the next user input gesture will be inserted.  The insertion
pointer will always be less than (fill-pointer (stream-input-buffer
<I> stream</I>)).  The insertion pointer can also be thought of as an editing
cursor.

<P>
 
(setf stream-insertion-pointer) pointer stream

<P>
Changes the input position of the <I> input editing stream</I> <I> stream</I> to
<I> pointer</I>.  <I> pointer</I> is an integer, and must be less than
(fill-pointer (stream-input-buffer <I> stream</I>)).

<P>
stream-scan-pointer stream

<P>
Returns an integer corresponding to the current scan pointer in the <I> input
editing stream</I> <I> stream</I>'s buffer, that is, the point in the buffer at which
calls to accept have stopped parsing input.  The scan pointer will always
be less than or equal to (stream-insertion-pointer <I> stream</I>).

<P>
 
(setf stream-scan-pointer) pointer stream

<P>
Changes the scan pointer of the <I> input editing stream</I> <I> stream</I> to
<I> pointer</I>.  <I> pointer</I> is an integer, and must be less than or equal to
(stream-insertion-pointer <I> stream</I>).

<P>
stream-rescanning-p stream

<P>
Returns the state of the <I> input editing stream</I> <I> stream</I>'s ``rescan in
progress'' flag, which is <I> true</I> if <I> stream</I> is performing a rescan
operation, otherwise it is <I> false</I>.  All extended input streams must
implement a method for this, but non-input editing streams will always returns
<I> false</I>.

<P>
reset-scan-pointer stream <TT> &amp;optional </TT>(scan-pointer 0)

<P>
Sets the <I> input editing stream</I> <I> stream</I>'s scan pointer to
<I> scan-pointer</I>, and sets the state of stream-rescanning-p to
<I> true</I>.

<P>
immediate-rescan stream

<P>
Invokes a rescan operation immediately by ``throwing'' out to the most recent
invocation of with-input-editing.

<P>
queue-rescan stream

<P>
Indicates that a rescan operation on the <I> input editing stream</I>
<I> stream</I> should take place after the next non-input editing gesture is read
by setting the ``rescan queued'' flag to <I> true</I>.

<P>
rescan-if-necessary stream

<P>
Invokes a rescan operation on the <I> input editing stream</I> <I> stream</I> if
queue-rescan was called on the same stream and no intervening rescan
operation has taken place.  Resets the state of the ``rescan queued'' flag to
<I> false</I>.

<P>
erase-input-buffer stream <TT> &amp;optional </TT>(start-position 0)

<P>
Erases the part of the display that corresponds to the input editor's buffer
starting at the position <I> start-position</I>.

<P>
redraw-input-buffer stream <TT> &amp;optional </TT>(start-position 0)

<P>
Displays the input editor's buffer starting at the position <I> start-position</I>
on the interactive stream that is encapsulated by the input editor stream
<I> stream</I>.

<P>
stream-process-gesture stream gesture type

<P>
If <I> gesture</I> is an input editing command, stream-process-gesture
performs the input editing operation on the <I> input editing stream</I>
<I> stream</I> and returns nil.  Otherwise, it returns the two values
<I> gesture</I> and <I> type</I>.

<P>
stream-read-gesture (stream standard-input-editing-stream) <TT> &amp;key </TT>

<P>
Reads and returns a gesture from the user on the <I> input editing stream</I>
<I> stream</I>.

<P>
The stream-read-gesture method must call stream-process-gesture, which
will either return a ``real'' gesture (such as a typed character, a pointer
gesture, or a timeout) or will return nil (indicating that some sort of
input editing operation was performed).  stream-read-gesture must only
return when a real gesture was been read; if an input editing operation was
performed, stream-read-gesture should loop until a ``real'' gesture is
typed by the user.

<P>
stream-unread-gesture (stream standard-input-editing-stream) gesture

<P>
Inserts the gesture <I> gesture</I> back into the input editor's buffer,
maintaining the scan pointer.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3932"
 HREF="node234.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3928"
 HREF="node232.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3922"
 HREF="node232.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3930"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3933"
 HREF="node234.html">Suggestions for Input Editing</A>
<B> Up:</B> <A NAME="tex2html3929"
 HREF="node232.html">The Input Editor</A>
<B> Previous:</B> <A NAME="tex2html3923"
 HREF="node232.html">The Input Editor</A>
 &nbsp <B>  <A NAME="tex2html3931"
 HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>&</I>
<BR><I>2001-06-12</I>
</ADDRESS>
</BODY>
</HTML>
