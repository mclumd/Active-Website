<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 99.1 release (March 30, 1999)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Defining Presentation Translators</TITLE>
<META NAME="description" CONTENT="Defining Presentation Translators">
<META NAME="keywords" CONTENT="clim">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v99.1 release">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="clim.css">

<LINK REL="next" HREF="node218.html">
<LINK REL="previous" HREF="node216.html">
<LINK REL="up" HREF="node216.html">
<LINK REL="next" HREF="node218.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3728"
 HREF="node218.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3724"
 HREF="node216.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3718"
 HREF="node216.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3726"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3729"
 HREF="node218.html">Presentation Translator Functions</A>
<B> Up:</B> <A NAME="tex2html3725"
 HREF="node216.html">Presentation Translators</A>
<B> Previous:</B> <A NAME="tex2html3719"
 HREF="node216.html">Presentation Translators</A>
 &nbsp <B>  <A NAME="tex2html3727"
 HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION07261000000000000000">
Defining Presentation Translators</A>
</H2>

<P>
define-presentation-translator name 
                                            (from-type to-type command-table
                                             <TT> &amp;key </TT>gesture
                                                  tester tester-definitive
                                                  documentation pointer-documentation 
                                                  menu priority)
                                            arglist
                                            <TT> &amp;body </TT>body

<P>
Defines a presentation translator named <I> name</I> that translates from objects
of type <I> from-type</I> to objects of type <I> to-type</I>.  <I> from-type</I> and
<I> to-type</I> are presentation type specifiers, but must not include any
presentation type options.  <I> from-type</I> and <I> to-type</I> may be
presentation type abbreviations.

<P>
 
<I> command-table</I> is a <I> command table designator</I>.  The translator created
by this invocation of define-presentation-translator will be stored in the
command table <I> command-table</I>.

<P>
 
<I> gesture</I> is a gesture name that names a pointer gesture (described in
Section&nbsp;<A HREF="node200.html#gesture-names">22.3</A>).  The body of the translator will be run only if
the translator is applicable and gesture used by the user matches the gesture
name in the translator.  (We will explain <I> applicability</I><A NAME="25820"></A>, or
<I> matching</I><A NAME="25822"></A>, in detail below.)  <I> gesture</I> defaults to :select.

<P>
 
<I> tester</I> is either a function or a list of the form

<BR>
<I> (tester-arglist . tester-body)</I>

<BR>
where <I> tester-arglist</I> takes the same form as <I> arglist</I> (see below), and
<I> tester-body</I> is the body of the tester.  The tester must return either
<I> true</I> or <I> false</I>.  If it returns <I> false</I>, then the translator is
definitely not applicable.  If it returns <I> true</I>, then the translator might
be applicable, and the body of the translator might be run (if
<I> tester-definitive</I> is <I> false</I>) in order to definitively decide if the
translator is applicable (this is described in more detail below).  If no tester
is supplied, CLIM supplies a tester that always returns <I> true</I>.

<P>
When the boolean <I> tester-definitive</I> is <I> true</I>, the body of the
translator will never be run in order to decide if the translator is applicable,
that is, the tester is assumed to definitively decide whether the translator
applies.  The default for <I> tester-definitive</I> is <I> false</I>.  When there
is no explicitly supplied tester, the tester supplied by CLIM is assumed to be
definitive.

<P>
Both <I> documentation</I> and <I> pointer-documentation</I> are objects that will
be used for documenting the translator.  <I> pointer-documentation</I> will be
used to generate documentation for the pointer documentation window; the
documentation generated by <I> pointer-documentation</I> should be very brief and
computing it should be very fast and preferably not cons.  <I> documentation</I>
is used to generate such things as items in the :menu-gesture menu.  If the
object is a string, the string itself will be used as the documentation.
Otherwise, the object must be the name of a function or a list of the form

<BR>
<I> (doc-arglist . doc-body)</I>

<BR>
where <I> doc-arglist</I> takes the same form as <I> arglist</I>, but includes a
named (keyword) <I> stream</I> argument as well (see below), and <I> doc-body</I>
is the body of the documentation function.  The body of the documentation
function should write the documentation to <I> stream</I>.  The default for
<I> documentation</I> is nil, meaning that there is no explicitly supplied
documentation; in this case, CLIM is free to generate the documentation in
other ways.  The default for <I> pointer-documentation</I> is <I> documentation</I>.

<P>
 
<I> menu</I> must be t or nil.  When it is t, the translator will
be included in the :menu-gesture menu if it matches.  When it is nil,
the translator will not be included in the :menu-gesture menu.  Other
non-nil values are reserved for future extensions to allow multiple
presentation translator menus.

<P>
 
<I> priority</I> is either nil (the default, which corresponds to 0) or an
integer that represents the priority of the translator.  When there are several
translators that match for the same gesture, the one with the highest priority
is chosen.

<P>
 
<I> arglist</I>, <I> tester-arglist</I>, and <I> doc-arglist</I> are each an argument
list that must ``match'' the following ``canonical'' argument list.

<BR>
<I> (object <TT> &amp;key </TT>presentation context-type frame event window x y)</I>

<BR>
In order to ``match'' the canonical argument list, there must be a single
positional argument that corresponds to the presentation's object, and
several named arguments that must match the canonical names above (using
string-equal to do the comparison).

<P>
In the body of the translator (or the tester), the position <I> object</I>
argument will be bound to the presentation's object.  The named arguments
<I> presentation</I> will be bound to the presentation that was clicked on,
<I> context-type</I> will be bound to the presentation type of the context that
actually matched, <I> frame</I> will be bound to the application frame that is
currently active (usually *application-frame*), <I> event</I> will be bound
to the pointer button event that the user used, <I> window</I> will be bound to
the window stream from which the event came, and <I> x</I> and <I> y</I> will be
bound to the 1#1 and 2#2 positions within <I> window</I> that the pointer was at
when the event occurred.  The special variable *input-context* will be
bound to the current input context.  Note that, in many implementations
<I> context-type</I> and *input-context* will have dynamic extent, and should
not be saved without first copying them.

<P>
 
<I> body</I> is the body of the translator, and is run in the context of the
application.  <I> body</I> may have zero or more declarations as its first forms.
It should return either one, two, or three values.  The first value is an object
which must be presentation-typep of <I> to-type</I>, and the second value is
a presentation type that must be presentation-subtypep of <I> to-type</I>.
The consequences are unspecified if the object is not presentation-typep of
<I> to-type</I> or the type is not presentation-subtypep of <I> to-type</I>.
The first two returned values of <I> body</I> are used, in effect, as the returned
values for the call to accept that established the matching input context.

<P>
The third value returned by <I> body</I> must either be nil or a list of
options (as keyword-value pairs) that will be interpreted by accept.  The
only option defined so far is :echo, whose value must be either <I> true</I>
(the default) or <I> false</I>.  If it is <I> true</I>, the object returned by the
translator will be ``echoed'' by accept, which will use
presentation-replace-input to insert the textual representation of the
object into the input buffer.  If it is <I> false</I>, the object will not be
echoed.

<P>
None of define-presentation-translator's arguments is evaluated.

<P>
define-presentation-to-command-translator name 
                                                       (from-type command-name command-table
                                                        <TT> &amp;key </TT>gesture tester
                                                             documentation pointer-documentation 
                                                             menu priority echo)
                                                       arglist
                                                       <TT> &amp;body </TT>body

<P>
This is similar to define-presentation-translator, except that the
<I> to-type</I> will be derived to be the command named by <I> command-name</I> in
the command table <I> command-table</I>.  <I> command-name</I> is the name of the
command that this translator will translate to.

<P>
The <I> echo</I> option is a boolean value (the default is <I> true</I>) that
indicates whether the command line should be echoed when a user invokes the
translator.

<P>
The other arguments to define-presentation-to-command-translator are the
same as for define-presentation-translator.  Note that the tester for
command translators is always assumed to be definitive, so there is no
:tester-definitive option. The default for <I> pointer-documentation</I> is
the string <I> command-name</I> with dash characters replaced by spaces, and each
word capitalized (as in add-command-to-command-table).

<P>
The body of the translator must return a list of the arguments to the command
named by <I> command-name</I>.  <I> body</I> is run in the context of the
application.  The returned value of the body, appended to the command name, are
eventually passed to execute-frame-command.  <I> body</I> may have zero or
more declarations as its first forms.

<P>
None of define-presentation-to-command-translator's arguments is evaluated.

<P>
define-presentation-action name 
                                        (from-type to-type command-table 
                                         <TT> &amp;key </TT>gesture tester
                                              documentation pointer-documentation
                                              menu priority)
                                        arglist
                                        <TT> &amp;body </TT>body

<P>
define-presentation-action is similar to define-presentation-translator,
except that the body of the action is not intended to return a value, but should
instead side-effect some sort of application state.

<P>
A presentation action does not satisfy a request for input the way an ordinary
translator does.  Instead, an action is something that happens while waiting for
input.  After the action has been executed, the program continues to wait for
the same input that it was waiting for prior to executing the action.

<P>
The other arguments to define-presentation-action are the same as for
define-presentation-translator.  Note that the tester for presentation
actions is always assumed to be definitive.

<P>
None of define-presentation-action's arguments is evaluated.

<P>
define-click-and-drag-translator name
                                              from-type to-type destination-type command-table 
                                              <TT> &amp;key </TT>gesture tester
                                                   documentation pointer-documentation
                                                   menu priority
                                                   feedback highlighting
                                              arglist
                                              <TT> &amp;body </TT>body)

<P>
Defines a ``direct manipulation'' translator named <I> name</I> that translates
from objects of type <I> from-type</I> to objects of type <I> to-type</I> when the
``from presentation'' is ``dragged'' over a ``to presentation'' having type
<I> destination-type</I>.  <I> from-type</I>, <I> to-type</I>, and
<I> destination-type</I> are presentation type specifiers, but must not include
any presentation type options.  <I> from-type</I>, <I> to-type</I> and
<I> destination-type</I> may be presentation type abbreviations.

<P>
The interaction style used by these translators is that a user points to a
``from presentation'' with the pointer, presses a pointer button matching
<I> gesture</I>, drags the ``from presentation'' to a ``to presentation'' by
moving the pointer, and then release the pointer button.  When the pointer
button is released, the translator whose <I> destination-type</I> matches the
presentation type of the ``to presentation'' is chosen.

<P>
While the pointer is being dragged, the function specified by <I> feedback</I> is
invoked to provide feedback to the user.  The function is called with eight
arguments: the application frame object, the ``from presentation'', the stream,
the initial 1#1 and 2#2 positions of the pointer, the current 1#1 and 2#2
positions of the pointer, and a feedback state (either :highlight to draw
feedback, or :unhighlight to erase it).  The feedback function is called to
draw some feedback the first time pointer moves, and is then called twice each
time the pointer moves thereafter (once to erase the previous feedback, and then
to draw the new feedback).  It is called a final time to erase the last feedback
when the pointer button is released.  <I> feedback</I> defaults
frame-click-and-drag-feedback.

<P>
When the ``from presentation'' is dragged over any other presentation that has a
direct manipulation translator, the function specified by <I> highlighting</I> is
invoked to highlight that object.  The function is called with four arguments:
the application frame object, the ``to presentation'' to be highlighted or
unhighlighted, the stream, and a highlighting state (either :highlight or
:unhighlight).  <I> highlighting</I> defaults to
frame-click-and-drag-highlighting.

<P>
The other arguments to define-presentation-to-command-translator are the
same as for define-presentation-translator.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3728"
 HREF="node218.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3724"
 HREF="node216.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3718"
 HREF="node216.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3726"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3729"
 HREF="node218.html">Presentation Translator Functions</A>
<B> Up:</B> <A NAME="tex2html3725"
 HREF="node216.html">Presentation Translators</A>
<B> Previous:</B> <A NAME="tex2html3719"
 HREF="node216.html">Presentation Translators</A>
 &nbsp <B>  <A NAME="tex2html3727"
 HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>&</I>
<BR><I>2001-06-12</I>
</ADDRESS>
</BODY>
</HTML>
