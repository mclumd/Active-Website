<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 99.1 release (March 30, 1999)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Incremental Redisplay Protocol</TITLE>
<META NAME="description" CONTENT="Incremental Redisplay Protocol">
<META NAME="keywords" CONTENT="clim">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v99.1 release">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="clim.css">

<LINK REL="next" HREF="node193.html">
<LINK REL="previous" HREF="node191.html">
<LINK REL="up" HREF="node189.html">
<LINK REL="next" HREF="node193.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3351"
 HREF="node193.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3347"
 HREF="node189.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3341"
 HREF="node191.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3349"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3352"
 HREF="node193.html">Incremental Redisplay Stream Protocol</A>
<B> Up:</B> <A NAME="tex2html3348"
 HREF="node189.html">Incremental Redisplay</A>
<B> Previous:</B> <A NAME="tex2html3342"
 HREF="node191.html">Standard Programmer Interface</A>
 &nbsp <B>  <A NAME="tex2html3350"
 HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION06730000000000000000">
Incremental Redisplay Protocol</A>
</H1>

<P>
updating-output-record

<P>
The protocol class corresponding to records that support incremental redisplay;
a subclass of output-record.
an updating output record updating-output-record

<P>
updating-output-record-p object

<P>
Returns <I> true</I> if <I> object</I> is an <I> updating output record</I>,
otherwise returns <I> false</I>.

<P>
 
:unique-id
:id-test
:cache-value
:cache-test
:fixed-position

<P>
All subclasses of updating-output-record must handle these four initargs,
which are used to specify, respectively, the unique id and id test, cache value
and cache test, and the ``fixed position'' component of the output record.

<P>
standard-updating-output-record

<P>
The instantiable class of output record that supports incremental redisplay.
This is a subclass of updating-output-record.

<P>
output-record-unique-id record

<P>
Returns the unique id associated with the updating output record <I> record</I>.

<P>
output-record-cache-value record

<P>
Returns the cache value associated with the updating output record <I> record</I>.

<P>
output-record-fixed-position record

<P>
Returns <I> true</I> if the updating output record <I> record</I> is at a fixed
location on the output stream, otherwise returns <I> false</I>.  Output records
that are not at fixed location on the output stream will be moved by incremental
redisplay when any of their siblings adjust their size or position.

<P>
output-record-displayer record

<P>
Returns the function that produces the output for this output record.  This is
the function that is called during redisplay to produce new output if the cache
value mismatches.

<P>
inferior-output-record-changed record child mode old-position old-extent stream
                                              <TT> &amp;optional </TT>erases moves draws erase-overlapping move-overlapping
                                              <TT> &amp;key </TT>check-overlapping

<P>
inferior-output-record-changed assumes that the output history already
reflects the changes made, but that no output (screen, or hardcopy, or ...) has
been done yet.  (Some) parent will (eventually) do the appropriate updates.
You must pass the ``differences list'' (output in the style of
compute-differences) to inferior-output-record-changed.  If you don't
know the optimized form of the differences, then you must call
compute-differences before you update the output record history, and pass
the results to inferior-output-record-changed.

<P>
 
<I> mode</I> is one of :delete, :add, :change, :move, or
:none

<P>
 
<I> old-position</I> and <I> old-extent</I> are where <I> child</I> was before it
was moved.

<P>
This is the protocol that must be supported by any output records that wish to
be compatible with incremental redisplay.

<P>
 
<I> Matching and automatic adjustment:</I>

<P>
match-output-records record <TT> &amp;rest </TT>init-args

<P>
Returns <I> true</I> if record matches the supplied init-args, otherwise returns
<I> false</I>.

<P>
find-inferior-output-record record use-old-elements record-type
                                           <TT> &amp;rest </TT>init-args
                                           <TT> &amp;key </TT>unique-id unique-id-test

<P>
Finds a child of <I> record</I> matching the <I> record-type</I> and
<I> init-args</I> supplied.  <I> unique-id</I> and <I> unique-id-test</I> are used to
match against the children as well.  <I> use-old-elements</I> controls whether
the desired record is to be found in the previous (before redisplay) contents of
the record.

<P>
decache-inferior-output-record record child use-old-elements

<P>
To be supplied.

<P>
output-record-contents-ok record

<P>
To be supplied.

<P>
recompute-contents-ok record

<P>
Compares the old (before redisplay) and new contents of <I> record</I> to
determine whether or not this record changed in such a way so that the display
needs updating.

<P>
 
<I> The following functions are called by</I> updating-output.

<P>
cache-output-record record child unique-id

<P>
 
<I> record</I> stores <I> child</I> such that it can be located later using <I> unique-id</I>.

<P>
find-cached-output-record record use-old-elements record-type
                                        <TT> &amp;rest </TT>init-args
                                        <TT> &amp;key </TT>unique-id unique-id-test <TT> &amp;allow-other-keys </TT>

<P>
Finds a previously cached child matching <I> record-type</I>, <I> init-args</I>,
<I> unique-id</I>, and <I> unique-id-test</I>.  <I> use-old-elements</I> controls
whether the desired record is to be found in the previous (before redisplay)
contents of the record.

<P>
 
<I> The following functions are called by</I> redisplay-output-record.

<P>
new-output-records record stream

<P>
The contract of new-output-records is to modify an output history to what
the record should look like now.  It must record all of the old positions in
old-extent, old-start-position, and old-elements.

<P>
It recurses down the descendents doing new-output-records on each
child.

<P>
new-output-records of an output record of type updating-output-record
runs the displayer, which gives the behavior of incremental redisplay.  That is,
it reruns the code (getting hints from updating-output) and figures out the
changes from there by comparing it to the old output history.

<P>
compute-differences record <TT> &amp;optional </TT>check-overlapping
                                                    (offset-x 0) (offset-y 0)
                                                    (old-offset-x 0) (old-offset-y 0) 

<P>
This operation compares the old and new versions of <I> record</I> and returns the
differences as 5 multiple values.  The values returned are <I> erases</I>,
<I> draws</I>, <I> moves</I>, <I> erase-overlapping</I>, and <I> move-overlapping</I>.
Each is a list of lists of the form:

<P>

<UL>
<LI><I> erases</I> are lists of (record old-extent)</LI>
<LI><I> draws</I> are lists of (record old-extent)</LI>
<LI><I> moves</I> are lists of (record old-extent new-position)</LI>
<LI><I> erase-overlapping</I> is a list of (record old-extent)</LI>
<LI><I> move-overlapping</I>, is a list of (record extent new-position)</LI>
</UL>

<P>
 
<I> The following functions are called by</I> inferior-output-record-changed.

<P>
augment-draw-set record

<P>
To be supplied.

<P>
propagate-inferior-output-record-changes-p record child mode 
                                                          old-position old-extent

<P>
propagate-inferior-output-record-changes-p is a predicate which returns
<I> true</I> if the change made to the child will cause <I> record</I> to be
redisplayed in any way.  Otherwise, it returns <I> false</I>.  <I> mode</I> is one
of :delete, :add, :change, :move, or :none.

<P>
propagate-output-record-changes 
            record child mode 
             <TT> &amp;optional </TT>(old-child-position (output-record-old-start-position child))
                       (old-child-extent (output-record-old-extent child))
                       erases moves draws erase-overlapping move-overlapping check-overlapping

<P>
To be supplied.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3351"
 HREF="node193.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3347"
 HREF="node189.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3341"
 HREF="node191.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3349"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3352"
 HREF="node193.html">Incremental Redisplay Stream Protocol</A>
<B> Up:</B> <A NAME="tex2html3348"
 HREF="node189.html">Incremental Redisplay</A>
<B> Previous:</B> <A NAME="tex2html3342"
 HREF="node191.html">Standard Programmer Interface</A>
 &nbsp <B>  <A NAME="tex2html3350"
 HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>&</I>
<BR><I>2001-06-12</I>
</ADDRESS>
</BODY>
</HTML>
