<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 99.1 release (March 30, 1999)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The Input Editor</TITLE>
<META NAME="description" CONTENT="The Input Editor">
<META NAME="keywords" CONTENT="clim">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v99.1 release">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="clim.css">

<LINK REL="next" HREF="node235.html">
<LINK REL="previous" HREF="node231.html">
<LINK REL="up" HREF="node231.html">
<LINK REL="next" HREF="node233.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3918"
 HREF="node233.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3914"
 HREF="node231.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3908"
 HREF="node231.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3916"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3919"
 HREF="node233.html">The Input Editing Stream</A>
<B> Up:</B> <A NAME="tex2html3915"
 HREF="node231.html">Input Editing and Completion</A>
<B> Previous:</B> <A NAME="tex2html3909"
 HREF="node231.html">Input Editing and Completion</A>
 &nbsp <B>  <A NAME="tex2html3917"
 HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION07310000000000000000">
The Input Editor</A>
</H1>

<P>
An input editing stream ``encapsulates'' an interactive stream, that is, most
operations are handled are handled by the encapsulated interactive stream, but
some operations are handled directly by the input editing stream itself.  (See
Appendix&nbsp;<A HREF="node300.html#encapsulating-streams">D</A> for a discussion of encapsulating streams.)

<P>
An input editing stream will have the following components:

<P>

<UL>
<LI>The encapsulated interactive stream.

<P>
 </LI>
<LI>A buffer with a fill pointer, which we shall refer to as 86#86.  The buffer
contains all of the user's input, and 86#86 is the length of that input.

<P>
 </LI>
<LI>An insertion pointer, which we shall refer to as 87#87.  The insertion
pointer is the point in the buffer at which the ``editing cursor'' is.

<P>
 </LI>
<LI>A scan pointer, which we shall refer to as 88#88.  The scan pointer is the
point in the buffer from which CLIM will get the next input gesture object (in
the sense of read-gesture).

<P>
 </LI>
<LI>A ``rescan queued'' flag indicating that the programmer (or CLIM)
requested that a ``rescan'' operation should take place before the next gesture
is read from the user.

<P>
 </LI>
<LI>A ``rescan in progress'' flag that indicates that CLIM is rescanning the
user's input, rather than reading freshly supplied gestures from the user.</LI>
</UL>

<P>
The input editing stream may also have other components to store internal state,
such as a slot to accumulate a numeric argument or remember the most recently
used presentation history, and so forth.  These other components are explicitly
left unspecified.

<P>
The high level description of the operation of the input editor is that it reads
either ``real'' gestures from the user (such as characters from the keyboard or
pointer button events) or input editing commands.  The input editing commands
can modify the state of the input buffer.  When such modifications take place,
it is necessary to ``rescan'' the input buffer, that is, reset the scan pointer
88#88 to its original state and reparse the contents of the input editor buffer
before reading any other gestures from the user.  While this rescanning
operation is taking place, the ``rescan in progress'' flag is set to
<I> true</I>.  The relationship 
<!-- MATH
 $SP \leq IP \leq FP$
 -->
89#89 always holds.

<P>
The overall control structure of the input editor is:

<P>
 
<PRE>

(catch 'rescan                  ;thrown to when a rescan is invoked
  (reset-scan-pointer stream)   ;sets STREAM-RESCANNING-P to T
  (loop
     (funcall continuation stream)))
</PRE>

<P>
where <I> stream</I> is the input editing stream and <I> continuation</I> is the
code supplied by the programmer, and typically contains calls to such functions
as accept and read-token (which will eventually call
stream-read-gesture).  When a rescan operation is invoked, it has the
effect of throwing to the rescan tag in the example above.  The loop is
terminated when an activation gesture is seen, and at that point the values
produced by <I> continuation</I> are returned as values from the input editor.

<P>
The important point is that functions such as accept, read-gesture,
and unread-gesture read (or restore) the next gesture object from the
buffer at the position pointed to by the scan pointer 88#88.  However, insertion
and input editing commands take place at the position pointed to by 87#87.  The
purpose of the rescanning operation is to eventually ensure that all the input
gestures issued by the user (typed characters, pointer button presses, and so
forth) have been read by CLIM.  During input editing, the input editor should
maintain some sort of visible cursor to remind the user of the position of 87#87.

<P>
The overall structure of stream-read-gesture on an input editing stream is:

<P>
 
<PRE>

(progn
  (rescan-if-necessary stream)
  (loop
    ;; If SP is less than FP
    ;;   Then get the next gesture from the input editor buffer at SP
    ;;   and increment SP
    ;;   Else read the next gesture from the encapsulated stream
    ;;   and insert it into the buffer at IP
    ;; Set the "rescan in progress" flag to false
    ;; Call STREAM-PROCESS-GESTURE on the gesture
    ;;   If it was a "real" gesture
    ;;     Then exit with the gesture as the result
    ;;     Else it was an input editing command (which has already been
    ;;     processed), so continue looping
    ))
</PRE>

<P>
When a new gesture object is inserted into the input editor buffer, it is
inserted at the insertion pointer 87#87.  If 90#90, this is accomplished by a
vector-push-extend-like operation on the input buffer and 86#86, and then
incrementing 87#87.  If 91#91, CLIM must first ``make room'' for the new
gesture in the input buffer, then insert the gesture at 87#87, then increment
both 87#87 and 86#86.

<P>
When the user requests an input editor motion command, only the insertion
pointer 87#87 is affected.  Motion commands do not need to request a rescan
operation.

<P>
When the user requests an input editor deletion command, the sequence of gesture
objects at 87#87 are removed, and 87#87 and 86#86 must be modified to reflect the
new state of the input buffer.  Deletion commands (and other commands that
modify the input buffer) must call immediate-rescan when they are done
modifying the buffer.

<P>
CLIM implementations are free to put special objects in the input editor buffer,
such as ``noise strings'' and ``accept results''.  A ``noise string'' is used to
represent some sort of in-line prompt and is never seen as input; the
prompt-for-accept method may insert a noise string into the input buffer.
An ``accept result'' is an object in the input buffer that is used to represent
some object that was inserted into the input buffer (typically via a pointer
gesture) that has no readable representation (in the Lisp sense);
presentation-replace-input may create accept results.  Noise strings are
skipped over by input editing commands, and accept results are treated as a
single gesture.

<P>
interactive-stream-p object

<P>
Returns <I> true</I> if <I> object</I> is an interactive stream, that is, a
bidrectional stream intended for user interactions.  Otherwise it returns
<I> false</I>.  The input editor need only be fully implemented for interactive
streams.

<P>
input-editing-stream

<P>
The protocol class that corresponds to an input editing stream.
an input editing stream input-editing-stream

<P>
input-editing-stream-p object

<P>
Returns <I> true</I> if <I> object</I> is an <I> input editing stream</I> (that is,
a stream of the sort created by a call to with-input-editing), otherwise
returns <I> false</I>.

<P>
standard-input-editing-stream

<P>
The class that implements CLIM's standard input editor.  This is the class of
stream created by calling with-input-editing.

<P>
Members of this class are mutable. 
<P>
with-input-editing (<TT> &amp;optional </TT>stream 
                                 <TT> &amp;key </TT>input-sensitizer initial-contents)
                                <TT> &amp;body </TT>body

<P>
Establishes a context in which the user can edit the input typed in on the
interactive stream <I> stream</I>.  <I> body</I> is then executed in this context,
and the values returned by <I> body</I> are returned as the values of
with-input-editing.  <I> body</I> may have zero or more declarations as its
first forms.

<P>
The <I> stream</I> argument is not evaluated, and must be a symbol that is bound
to an input stream.  If <I> stream</I> is t (the default), *query-io* is
used.  If <I> stream</I> is a stream that is not an interactive stream, then
with-input-editing is equivalent to progn.

<P>
 
<I> input-sensitizer</I>, if supplied, is a function of two arguments, a stream
and a continuation; it has dynamic extent.  The continuation, supplied by CLIM,
is responsible for displaying output corresponding to the user's input on the
stream.  The <I> input-sensitizer</I> function will typically call
with-output-as-presentation in order to make the output produced by the
continuation sensitive.

<P>
If <I> initial-contents</I> is supplied, it must be either a string or a list of
two elements, an object and a presentation type.  If it is a string, the string
will be inserted into the input buffer using replace-input.  If it is a
list, the printed representation of the object will be inserted into the input
buffer using presentation-replace-input.

<P>
with-input-editor-typeout (<TT> &amp;optional </TT>stream) <TT> &amp;body </TT>body

<P>
Establishes a context inside of with-input-editing in which output can be
done by <I> body</I> to the input editing stream <I> stream</I>.
with-input-editor-typeout should call fresh-line before and after
evaluating the body.  <I> body</I> may have zero or more declarations as its first
forms.

<P>
The <I> stream</I> argument is not evaluated, and must be a symbol that is bound
to a stream.  If <I> stream</I> is t (the default), *query-io* is used.
If <I> stream</I> is a stream that is not an input editing stream, then
with-input-editor-typeout is equivalent to calling fresh-line,
evaluating the body, and then calling fresh-line again.

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html3920"
 HREF="node233.html">The Input Editing Stream Protocol</A>
<LI><A NAME="tex2html3921"
 HREF="node234.html">Suggestions for Input Editing Commands</A>
</UL>
<!--End of Table of Child-Links-->
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3918"
 HREF="node233.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3914"
 HREF="node231.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3908"
 HREF="node231.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3916"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3919"
 HREF="node233.html">The Input Editing Stream</A>
<B> Up:</B> <A NAME="tex2html3915"
 HREF="node231.html">Input Editing and Completion</A>
<B> Previous:</B> <A NAME="tex2html3909"
 HREF="node231.html">Input Editing and Completion</A>
 &nbsp <B>  <A NAME="tex2html3917"
 HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>&</I>
<BR><I>2001-06-12</I>
</ADDRESS>
</BODY>
</HTML>
