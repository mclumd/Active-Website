<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 99.1 release (March 30, 1999)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The Extended Input Stream Protocol</TITLE>
<META NAME="description" CONTENT="The Extended Input Stream Protocol">
<META NAME="keywords" CONTENT="clim">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v99.1 release">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="clim.css">

<LINK REL="previous" HREF="node198.html">
<LINK REL="up" HREF="node198.html">
<LINK REL="next" HREF="node200.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html3485"
 HREF="node200.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3481"
 HREF="node198.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3477"
 HREF="node198.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3483"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3486"
 HREF="node200.html">Gestures and Gesture Names</A>
<B> Up:</B> <A NAME="tex2html3482"
 HREF="node198.html">Extended Input Streams</A>
<B> Previous:</B> <A NAME="tex2html3478"
 HREF="node198.html">Extended Input Streams</A>
 &nbsp <B>  <A NAME="tex2html3484"
 HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION07121000000000000000">
The Extended Input Stream Protocol</A>
</H2>

<P>
The following generic functions comprise the extended input stream protocol.
All extended input streams must implement methods for these generic functions.

<P>
stream-input-buffer stream
(setf stream-input-buffer) buffer stream

<P>
The functions provide access to the stream's input buffer.  Normally programs do
not need to manipulate the input buffer directly.  It is sometimes useful to
cause several streams to share the same input buffer so that input that comes in
on one of them is available to an input call on any of the streams.  The input
buffer must be vector with a fill pointer capable of holding general input
gesture objects (such characters and event objects).

<P>
stream-pointers stream

<P>
Returns the list of pointer objects corresponding to the pointing devices of the
port associated with <I> stream</I>.
This function returns objects that reveal CLIM's internal state;
do not modify those objects. 
<P>
stream-primary-pointer stream
(setf stream-primary-pointer) pointer stream

<P>
Returns (or sets) the pointer object corresponding to the primary pointing
device of the console.

<P>
 
<B> Note:</B> CLIM currently supports only a single pointer for any port.
Therefore, the length of the list returned by stream-pointers will always
be one, and stream-primary-pointer will always return an object that is the
only element of that list.

<P>
stream-pointer-position* stream <TT> &amp;key </TT>pointer

<P>
Returns the current position of the pointing device <I> pointer</I> for the
<I> extended input stream</I> <I> stream</I> as two values, the 1#1 and 2#2
positions in the stream's drawing surface coordinate system.  If <I> pointer</I>
is not supplied, it defaults to the stream-primary-pointer of the stream.

<P>
 
(setf stream-pointer-position*) x y stream <TT> &amp;key </TT>pointer

<P>
Sets the position of the pointing device for the <I> extended input stream</I>
<I> stream</I> to <I> x</I> and <I> y</I>, which are integers.  <I> pointer</I> is as
for stream-pointer-position*.

<P>
stream-set-input-focus stream

<P>
Sets the ``input focus'' to the <I> extended input stream</I> <I> stream</I> and
returns the old input focus as its value.

<P>
stream-restore-input-focus stream old-focus

<P>
Restores the ``input focus'' of the <I> extended input stream</I> <I> stream</I> to
<I> old-focus</I>.

<P>
with-input-focus (stream) <TT> &amp;body </TT>body

<P>
Temporarily gives the keyboard input focus to the <I> extended input stream</I>
<I> stream</I>.  By default, an application frame gives the input focus to the
window associated with frame-query-io.

<P>
The <I> stream</I> argument is not evaluated, and must be a symbol that is bound
to a stream.  If <I> stream</I> is t, *standard-input* is used.
<I> body</I> may have zero or more declarations as its first forms.

<P>
 
*input-wait-test*
*input-wait-handler*
*pointer-button-press-handler*

<P>
These three variables are used to hold the default values for the current input
wait test, wait handler, and pointer button press handler.

<P>
read-gesture <TT> &amp;key </TT>(stream *standard-input*)
                            timeout peek-p 
                            (input-wait-test *input-wait-test*)
                            (input-wait-handler *input-wait-handler*)
                            (pointer-button-press-handler *pointer-button-press-handler*)

<P>
Calls stream-read-gesture on the <I> extended input stream</I> <I> stream</I>
and all of the other keyword arguments.  These arguments are the same as for
stream-read-gesture.

<P>
stream-read-gesture stream
                                   <TT> &amp;key </TT>timeout peek-p 
                                        (input-wait-test *input-wait-test*)
                                        (input-wait-handler *input-wait-handler*)
                                        (pointer-button-press-handler *pointer-button-press-handler*)

<P>
Returns the next gesture available in the <I> extended input stream</I>
<I> stream</I>; the gesture will be either a character or an event (such as a
pointer button event).  The input is not echoed.  If the user types an abort
gesture (that is, a gesture that matches any of the gesture names in
*abort-gestures*), then the abort-gesture condition will be signalled.

<P>
stream-read-gesture works by invoking stream-input-wait on
<I> stream</I>, <I> input-wait-test</I>, and <I> timeout</I>, and then processing the
input, if there is any.  :around methods on this generic function invoke a
gesture preprocessing mechanism on every gesture.  For a discussion of this
facility, see the Section&nbsp;<A HREF="node204.html#gesture-preproc">22.6</A>.

<P>
 
<I> timeout</I> is either nil or an integer that specifies the number of
seconds that stream-read-gesture will wait for input to become available.
If no input is available, stream-read-gesture will return two values,
nil and :timeout.

<P>
If the boolean <I> peek-p</I> is <I> true</I>, then the returned gesture will be
left in the stream's input buffer.

<P>
 
<I> input-wait-test</I> is a function of one argument, the stream.  The function
should return <I> true</I> when there is input to process, otherwise it should
return <I> false</I>.  This argument will be passed on to stream-input-wait.

<P>
 
<I> input-wait-handler</I> is a function of one argument, the stream.  It is
called when stream-input-wait returns <I> false</I> (that is, no input is
available).  This option can be used in conjunction with <I> input-wait-test</I>
to handle conditions other than keyboard gestures, or to provide some sort of
interactive behavior (such as highlighting applicable presentations).

<P>
 
<I> pointer-button-press-handler</I> is a function of two arguments, the stream
and a pointer button press event.  It is called when the user clicks a pointer
button.

<P>
 
<I> input-wait-test</I>, <I> input-wait-handler</I>, and
<I> pointer-button-press-handler</I> have dynamic extent.

<P>
stream-input-wait stream <TT> &amp;key </TT>timeout input-wait-test

<P>
Waits for input to become available on the <I> extended input stream</I>
<I> stream</I>.  <I> timeout</I> and <I> input-wait-test</I> are as for
stream-read-gesture.

<P>
unread-gesture gesture <TT> &amp;key </TT>(stream *standard-input*)

<P>
Calls stream-unread-gesture on <I> gesture</I> and <I> stream</I>.  These
arguments are the same as for stream-unread-gesture.

<P>
stream-unread-gesture stream gesture

<P>
Places <I> gesture</I> back into the <I> extended input stream</I> <I> stream</I>'s
input buffer.  The next call to stream-read-gesture request will return the
unread gesture.  The gesture supplied must be the most recent gesture read from
the stream via read-gesture.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html3485"
 HREF="node200.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/icons/next_motif.gif"></A> 
<A NAME="tex2html3481"
 HREF="node198.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/icons/up_motif.gif"></A> 
<A NAME="tex2html3477"
 HREF="node198.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/icons/previous_motif.gif"></A> 
<A NAME="tex2html3483"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/icons/contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3486"
 HREF="node200.html">Gestures and Gesture Names</A>
<B> Up:</B> <A NAME="tex2html3482"
 HREF="node198.html">Extended Input Streams</A>
<B> Previous:</B> <A NAME="tex2html3478"
 HREF="node198.html">Extended Input Streams</A>
 &nbsp <B>  <A NAME="tex2html3484"
 HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>&</I>
<BR><I>2001-06-12</I>
</ADDRESS>
</BODY>
</HTML>
